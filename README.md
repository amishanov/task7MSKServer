# Задание 7 (МСК)

## Исполнитель: Мишанов Алексей Борисович


### Задание
Поскольку задание сформулировано несколько странно, например, не предусмотрен метод получения всего списка диалогов, 
я немного изменил методы.
В результате в рамках приложения реализовано:
-  registerNewClient(nickname) - Регистрация нового клиента приложения - возвращает присвоенный клиенту ID. 
При этом в запросе дополнительно присылается псевдоним (nickname) клиента;
-  getAllClients() - Получения списка всех зарегистрированных пользователей - возвращает список всех ID клиентов;
- startDialog(clientFromId, clientToId) - Начало диалога по Id клиента - создание нового диалога, в котором 
участвуют два клиента с переданными id. Метод отличается от изначального тем, что позволяет фиксировать обоих 
пользователей диалога;
- stopDialog(dialogId) - Удаляет диалог по его Id. Также удаляет все уведомления, связанные с этим диалогом;
- getAllDialogsId(clientId) - Находит все диалоги, в которых участвует пользователь;
- sendMessage(message) - Отправка сообщения - при этом в передаваемом message описывается: 
id диалога, в который сообщение отправляется, nickname пользователя-отправителя сообщения и сам текст сообщения. 
Важно заметить, что метод не просто фиксирует отправку нового сообщения, но и создаёт новое уведомление (Notification)
для клиентов диалога, в который отправляется сообщение;
- getMessagesByDialogId(dialogId, clientId) - Загружает историю сообщений из диалога. ClientId передаётся, чтобы при 
этом в для этого клиента удалились уведомления, связанные с этим диалогом, поскольку считается, что он посмотрел новые 
сообщение (т.е. это работает как в мессенджерах).
- getUpdatesForMe(clientId) - Возвращает уведомления (Notifications) для клиента clientId. 
### Описание реализации
В рамках текущей реализации сервер работает с базой данных H2.
#### Models
1. *Client* - Описывает отдельного клиента. Содержит информацию о его ID, nickname и списке диалогов, в котором он учавствует
2. *Dialog* - Описывает отдельный диалог. Содержит информацию о его ID, всех участниках и списке сообщений. 
Поскольку в рамках текущей реализации предусмотрен чат только между двумя клиентами, а сообщения хранятся в 
отдельной сущности такая модель является избыточной (в конечном счёте, мы храним только ID), однако её использование обеспечивает 
гибкость, поскольку, если мы захотим добавить дополнительную информацию для чата (например, время создания), то достаточно 
дополнить эту сущность, а использование списка клиентов вместо информации только о двух позволит расширить диалог между двумя клиентами до полноценного 
чата с множеством участников.
3. *Message* - Описывает отдельное сообщение. Содержит информацию о ID сообщения, его авторе (nickname отправителя) и диалоге, 
в который было отправлено сообщение.
4. *Notification* - Описывает отдельное уведомление. Содержит информацию о ID уведомления, клиенте, которому оно 
предназначено и диалоге, которому оно принадлежит. В текущей реализации уведомление содержит
лишь информацию о новом сообщении в диалоге, но отдельная сущность Notification предусматривает простое расширение формата уведомлений.

#### Прочие элементы реализации

1. *Controllers* - контроллеры работают с описанными в задании методами.
2. *Services* - реализуют бизнес логику для методов контроллеров. Работа сложных методов описана в документации
3. *Repositories* - репозитории наследованы от JPARepository и используют стандартные операции.
4. *DTOs* - DTO объекты созданы для удобной передачи JSON. При этом IdDTO - универсальная обёртка для всех мест, 
где нужен только Id. MessageDTO используется для отправки новых сообщений в системе (sendMessage), 
а ResponseMessageDTO используется при получении всех сообщений в диалоге (getMessagesByDialogId).

### Оригинальное задание

Реализовать решение (можно с UI, можно в виде консольного приложения) для обмена сообщениями.<br>
Детально: Реализовать два приложения - сервер чата и клиент чата.
Обмен между приложениями REST сервисы, хранение сообщений любое хранилище
(даже простая Map на сервере подойдет)<br>
Сервер должен предоставлять API: <br>
- Регистрация запущенных экземпляров клиентского приложения - registerNewClient() - возвращает присвоенный клиенту ID<br>
- Получение списка ID зарегистрированных клиентских приложений - getAllClients() - возвращает список всех ID<br>
- Начало диалога по ID - startDialog(clientId) - возвращает ID сессии диалога<br>
- Завершение и удаление диалога по ID - stopDialog(dialogSessionId)<br>
- Отправка сообщения - sendMessage(dialogSessionId)<br>
- Опрос сервера каждым клиентом для получения обновлений
  (новые инициированные диалоги или сообщение в существующем диалоге или завершение существующего диалога)
  getUpdatesForMe(myClientId) - возвращает новые сообщения